<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="1" failures="4" skipped="0" tests="35" time="291.775" timestamp="2026-01-16T01:09:47.099009-06:00" hostname="yamaguchi"><testcase classname="integration.test_comprehensive_serialization.TestDeterministicTrainingResume" name="test_deterministic_training_resume" time="213.278"><failure message="AssertionError: &#10;Arrays are not almost equal to 5 decimals&#10;Resumed training diverged from continuous training&#10;Mismatched elements: 10 / 10 (100%)&#10;First 5 mismatches are at indices:&#10; [0, 0]: -0.06055125594139099 (ACTUAL), -0.09020629525184631 (DESIRED)&#10; [1, 0]: 0.17347075045108795 (ACTUAL), 0.14152517914772034 (DESIRED)&#10; [2, 0]: 0.6829667091369629 (ACTUAL), 0.6615568399429321 (DESIRED)&#10; [3, 0]: -0.4994625747203827 (ACTUAL), -0.5184578895568848 (DESIRED)&#10; [4, 0]: 0.5226701498031616 (ACTUAL), 0.5043010711669922 (DESIRED)&#10;Max absolute difference among violations: 0.03194557&#10;Max relative difference among violations: 0.5111792&#10; ACTUAL: array([[-0.06055],&#10;       [ 0.17347],&#10;       [ 0.68297],...&#10; DESIRED: array([[-0.09021],&#10;       [ 0.14153],&#10;       [ 0.66156],...">self = &lt;test_comprehensive_serialization.TestDeterministicTrainingResume testMethod=test_deterministic_training_resume&gt;

    def test_deterministic_training_resume(self):
        """
        Critical test: Train → Save → Load → Resume should be identical to continuous training.
        This is the most important test for deterministic reproducibility.
        """
        # Setup
        config = CascadeCorrelationConfig(
            input_size=2,
            output_size=1,
            candidate_pool_size=3,
            candidate_epochs=10,
            output_epochs=20,
            max_hidden_units=2,
            random_seed=42,
        )
    
        # Create test data
        torch.manual_seed(42)
        x_train = torch.randn(50, 2)
        y_train = (x_train[:, 0] &gt; x_train[:, 1]).float().unsqueeze(1)
    
        # Scenario A: Train for 20 epochs, save, train for 20 more
        network_a = CascadeCorrelationNetwork(config=config)
        network_a.fit(
            x_train=x_train,
            y_train=y_train,
            max_epochs=20
        )
        serializer = CascadeHDF5Serializer()
        with tempfile.NamedTemporaryFile(suffix=".h5", delete=False) as f:
            temp_file = f.name
        try:
            success = serializer.save_network(network_a, temp_file)
            self.assertTrue(success, "Failed to save network")
            network_a_resumed = serializer.load_network(temp_file)
            self.assertIsNotNone(network_a_resumed, "Failed to load network")
            network_a_resumed.fit(x_train, y_train, epochs=20)
    
            # Scenario B: Train continuously for 40 epochs
            network_b = CascadeCorrelationNetwork(config=config)
            network_b.fit(x_train, y_train, epochs=40)
    
            # Verify outputs are identical
            torch.manual_seed(999)  # Different seed for test data
            test_x = torch.randn(10, 2)
            output_a = network_a_resumed.forward(test_x)
            output_b = network_b.forward(test_x)
&gt;           np.testing.assert_array_almost_equal(
                output_a.detach().numpy(),
                output_b.detach().numpy(),
                decimal=5,
                err_msg="Resumed training diverged from continuous training",
            )
E           AssertionError: 
E           Arrays are not almost equal to 5 decimals
E           Resumed training diverged from continuous training
E           Mismatched elements: 10 / 10 (100%)
E           First 5 mismatches are at indices:
E            [0, 0]: -0.06055125594139099 (ACTUAL), -0.09020629525184631 (DESIRED)
E            [1, 0]: 0.17347075045108795 (ACTUAL), 0.14152517914772034 (DESIRED)
E            [2, 0]: 0.6829667091369629 (ACTUAL), 0.6615568399429321 (DESIRED)
E            [3, 0]: -0.4994625747203827 (ACTUAL), -0.5184578895568848 (DESIRED)
E            [4, 0]: 0.5226701498031616 (ACTUAL), 0.5043010711669922 (DESIRED)
E           Max absolute difference among violations: 0.03194557
E           Max relative difference among violations: 0.5111792
E            ACTUAL: array([[-0.06055],
E                  [ 0.17347],
E                  [ 0.68297],...
E            DESIRED: array([[-0.09021],
E                  [ 0.14153],
E                  [ 0.66156],...

src/tests/integration/test_comprehensive_serialization.py:79: AssertionError</failure></testcase><testcase classname="integration.test_comprehensive_serialization.TestHiddenUnitsPreservation" name="test_hidden_units_preservation" time="1.856" /><testcase classname="integration.test_comprehensive_serialization.TestConfigRoundtrip" name="test_config_roundtrip" time="1.773" /><testcase classname="integration.test_comprehensive_serialization.TestActivationFunctionRestoration" name="test_activation_function_restoration" time="5.415" /><testcase classname="integration.test_comprehensive_serialization.TestTorchRandomStateRestoration" name="test_torch_random_state_restoration" time="2.840" /><testcase classname="integration.test_comprehensive_serialization.TestHistoryPreservation" name="test_history_preservation" time="1.846" /><testcase classname="integration.test_serialization.TestUUIDPersistence" name="test_uuid_preserved_after_load" time="1.982" /><testcase classname="integration.test_serialization.TestUUIDPersistence" name="test_multiple_save_load_cycles_preserve_uuid" time="4.071" /><testcase classname="integration.test_serialization.TestRandomSeedPreservation" name="test_random_seed_parameters_preserved" time="2.091" /><testcase classname="integration.test_serialization.TestRandomSeedPreservation" name="test_deterministic_forward_pass" time="1.868" /><testcase classname="integration.test_serialization.TestRandomSeedPreservation" name="test_random_state_data_in_file" time="0.973" /><testcase classname="integration.test_serialization.TestHistoryPreservation" name="test_history_keys_preserved" time="2.068" /><testcase classname="integration.test_serialization.TestHistoryPreservation" name="test_hidden_units_history_preserved" time="2.326" /><testcase classname="integration.test_serialization.TestConfigRoundtrip" name="test_config_serialization_excludes_non_serializable" time="1.917" /><testcase classname="integration.test_serialization.TestConfigRoundtrip" name="test_config_values_preserved" time="1.949" /><testcase classname="integration.test_serialization.TestActivationFunctionRestoration" name="test_activation_function_name_restored" time="1.890" /><testcase classname="integration.test_serialization.TestActivationFunctionRestoration" name="test_activation_function_callable_restored" time="1.939" /><testcase classname="integration.test_serialization.TestHiddenUnitsPreservation" name="test_hidden_units_count_preserved" time="2.079" /><testcase classname="integration.test_serialization.TestHiddenUnitsPreservation" name="test_hidden_units_weights_preserved" time="1.939" /><testcase classname="integration.test_serialization.TestHiddenUnitsPreservation" name="test_hidden_units_checksums_verified" time="2.081" /><testcase classname="integration.test_serialization.TestShapeValidation" name="test_output_weights_shape_validated" time="1.904" /><testcase classname="integration.test_serialization.TestShapeValidation" name="test_hidden_units_shape_validated" time="1.966" /><testcase classname="integration.test_serialization.TestFormatValidation" name="test_valid_format_accepted" time="1.989" /><testcase classname="integration.test_serialization.TestFormatValidation" name="test_format_verification_info" time="0.967" /><testcase classname="integration.test_serialization.TestRandomStateRestoration" name="test_python_random_state_restoration" time="2.923" /><testcase classname="integration.test_serialization.TestRandomStateRestoration" name="test_numpy_random_state_restoration" time="3.029" /><testcase classname="integration.test_serialization.TestRandomStateRestoration" name="test_torch_random_state_restoration" time="3.043" /><testcase classname="integration.test_serialization.TestRandomStateRestoration" name="test_deterministic_training_resume" time="3.414" /><testcase classname="integration.test_spiral_problem.TestSpiralProblemBasic" name="test_2_spiral_learning" time="3.959"><failure message="AssertionError: Network did not learn: initial_loss=0.243668, final_loss=0.243668: improvement=0.000000 &lt; min_improvement=0.01">self = &lt;test_spiral_problem.TestSpiralProblemBasic object at 0x719c90baee90&gt;
spiral_network = &lt;cascade_correlation.cascade_correlation.CascadeCorrelationNetwork object at 0x719c917e9010&gt;

    @pytest.mark.integration
    @pytest.mark.spiral
    @pytest.mark.slow
    def test_2_spiral_learning(self, spiral_network):
        """Test that network can learn 2-spiral problem."""
        set_deterministic_behavior(42)
    
        # Generate 2-spiral data
        # x, y, info = SpiralDataGenerator.generate_2_spiral(
        x, y, _ = SpiralDataGenerator.generate_2_spiral(
            n_per_spiral=50,
            noise=0.05,
            seed=42
        )
    
        # Train network
        initial_accuracy = spiral_network.calculate_accuracy(x, y)
        history, elapsed_time = measure_training_time(
            spiral_network, x, y, max_epochs=10, early_stopping=False
        )
        final_accuracy = spiral_network.calculate_accuracy(x, y)
        # Verify learning occurred
&gt;       assert_network_learns(
            initial_loss=history['train_loss'][0],
            final_loss=history['train_loss'][-1],
            min_improvement=0.01
        )

src/tests/integration/test_spiral_problem.py:55: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

initial_loss = 0.2436680942773819, final_loss = 0.2436680942773819
min_improvement = 0.01
msg = 'Network did not learn: initial_loss=0.243668, final_loss=0.243668'

    def assert_network_learns(
        initial_loss: float,
        final_loss: float,
        min_improvement: float = 0.01,
        msg: Optional[str] = None
    ) -&gt; None:
        """
        Assert that network shows learning (loss improvement).
    
        Args:
            initial_loss: Loss at start of training
            final_loss: Loss at end of training
            min_improvement: Minimum relative improvement required
            msg: Optional error message
        """
        if msg is None:
            msg = f"Network did not learn: initial_loss={initial_loss:.6f}, final_loss={final_loss:.6f}"
    
        improvement = (initial_loss - final_loss) / initial_loss
&gt;       assert improvement &gt;= min_improvement, f"{msg}: improvement={improvement:.6f} &lt; min_improvement={min_improvement}" # trunk-ignore(bandit/B101)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AssertionError: Network did not learn: initial_loss=0.243668, final_loss=0.243668: improvement=0.000000 &lt; min_improvement=0.01

src/tests/helpers/assertions.py:340: AssertionError</failure></testcase><testcase classname="integration.test_spiral_problem.TestSpiralProblemBasic" name="test_3_spiral_learning" time="3.939"><failure message="assert 0.35 &gt; 0.35">self = &lt;test_spiral_problem.TestSpiralProblemBasic object at 0x719c90baf110&gt;
spiral_network = &lt;cascade_correlation.cascade_correlation.CascadeCorrelationNetwork object at 0x719c84d50d70&gt;

    @pytest.mark.integration
    @pytest.mark.spiral
    def test_3_spiral_learning(self, spiral_network):
        """Test that network can learn 3-spiral problem."""
        set_deterministic_behavior(42)
    
        # Generate 3-spiral data
        # x, y, info = SpiralDataGenerator.generate_n_spiral(
        x, y, _ = SpiralDataGenerator.generate_n_spiral(
            n_spirals=3,
            n_per_spiral=40,
            noise=0.03,
            seed=42
        )
    
        # Adjust network for 3-class problem
        spiral_network.output_size = 3
        spiral_network.output_weights = torch.randn(
            spiral_network.input_size, 3, requires_grad=True
        ) * spiral_network.random_value_scale
        spiral_network.output_bias = torch.randn(3, requires_grad=True) * spiral_network.random_value_scale
    
        # Train network
        initial_accuracy = spiral_network.calculate_accuracy(x, y)
        history = spiral_network.fit(x, y, max_epochs=8)
        final_accuracy = spiral_network.calculate_accuracy(x, y)
    
        # Verify learning
&gt;       assert final_accuracy &gt; initial_accuracy  # trunk-ignore(bandit/B101)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 0.35 &gt; 0.35

src/tests/integration/test_spiral_problem.py:100: AssertionError</failure></testcase><testcase classname="integration.test_spiral_problem.TestSpiralProblemProgressive" name="test_n_spiral_difficulty_progression[2]" time="3.512"><failure message="assert 0.5 &gt;= 0.5166666666666667">self = &lt;test_spiral_problem.TestSpiralProblemProgressive object at 0x719c90baf4d0&gt;
n_spirals = 2

    @pytest.mark.integration
    @pytest.mark.spiral
    @pytest.mark.slow
    @pytest.mark.parametrize("n_spirals", [2, 3, 4])
    def test_n_spiral_difficulty_progression(self, n_spirals):
        """Test that network can handle increasing spiral complexity."""
        set_deterministic_behavior(42)
    
        # Create network configured for n-spiral problem
        from cascade_correlation.cascade_correlation import CascadeCorrelationNetwork
        network = CascadeCorrelationNetwork.create_simple_network(
            input_size=2,
            output_size=n_spirals,
            learning_rate=0.05,
            max_hidden_units=min(8, n_spirals * 2),
            candidate_pool_size=12,
            correlation_threshold=0.15
        )
    
        # Generate n-spiral data
        # x, y, info = SpiralDataGenerator.generate_n_spiral(
        x, y, _ = SpiralDataGenerator.generate_n_spiral(
            n_spirals=n_spirals,
            n_per_spiral=30,
            noise=0.02,
            seed=42
        )
    
        # Train network
        initial_accuracy = network.calculate_accuracy(x, y)
        history = network.fit(x, y, max_epochs=6)
        final_accuracy = network.calculate_accuracy(x, y)
    
        # Basic learning verification
&gt;       assert final_accuracy &gt;= initial_accuracy # trunk-ignore(bandit/B101)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 0.5 &gt;= 0.5166666666666667

src/tests/integration/test_spiral_problem.py:147: AssertionError</failure></testcase><testcase time="0.002" /><testcase classname="pytest" name="internal" time="0.000"><error message="internal error">Traceback (most recent call last):
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/main.py", line 318, in wrap_session
    session.exitstatus = doit(config, session) or 0
                         ~~~~^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/main.py", line 372, in _main
    config.hook.pytest_runtestloop(session=session)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/logging.py", line 801, in pytest_runtestloop
    return (yield)  # Run all the tests.
            ^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/terminal.py", line 714, in pytest_runtestloop
    result = yield
             ^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/opt/miniforge3/envs/JuniperCascor/lib/python3.14/site-packages/pytest_cov/plugin.py", line 345, in pytest_runtestloop
    result = yield
             ^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/main.py", line 396, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/assertion/__init__.py", line 192, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/unittest.py", line 573, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 139, in _multicall
    teardown.throw(exception)
    ~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/faulthandler.py", line 102, in pytest_runtest_protocol
    return (yield)
            ^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/runner.py", line 118, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/runner.py", line 137, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
                   ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/runner.py", line 251, in call_and_report
    ihook.pytest_runtest_logreport(report=report)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 167, in _multicall
    raise exception
  File "/home/pcalnon/.local/lib/python3.14/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/terminal.py", line 705, in pytest_runtest_logreport
    self.flush()
    ~~~~~~~~~~^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/terminal.py", line 538, in flush
    self._tw.flush()
    ~~~~~~~~~~~~~~^^
  File "/home/pcalnon/.local/lib/python3.14/site-packages/_pytest/_io/terminalwriter.py", line 187, in flush
    self._file.flush()
    ~~~~~~~~~~~~~~~~^^
BrokenPipeError: [Errno 32] Broken pipe</error></testcase></testsuite></testsuites>