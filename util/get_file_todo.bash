#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Sub-Project:   JuniperCanopy
# Application:   juniper_canopy
# Purpose:       Monitoring and Diagnostic Frontend for Cascade Correlation Neural Network
#
# Author:        Paul Calnon
# Version:       1.0.0
# File Name:     get_file_todo.bash
# File Path:     <Project>/<Sub-Project>/<Application>/util/
#
# Date:          2025-12-03
# Last Modified: 2025-12-25
#
# License:       MIT License
# Copyright:     Copyright (c) 2024,2025,2026 Paul Calnon
#
# Description:
#     This script returns the number of TODO comments in each file.
#
#####################################################################################################################################################################################################
# Notes:
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Source script config file
#####################################################################################################################################################################################################
set -o functrace

# Use script's own path to find init.conf (works from any directory)
SCRIPT_PATH="$(realpath "${BASH_SOURCE[0]}")"
SCRIPT_DIR="$(dirname "${SCRIPT_PATH}")"

export PARENT_PATH_PARAM="${SCRIPT_PATH}"
INIT_CONF="$(realpath "${SCRIPT_DIR}/../conf/init.conf")"

# shellcheck disable=SC1090
if [[ -f "${INIT_CONF}" ]]; then
    source "${INIT_CONF}"
else
    echo "Init Config File Not Found at ${INIT_CONF}. Unable to Continue."
    exit 1
fi


#######################################################################################################################################################################################
# Define usage function for help and error messages
#######################################################################################################################################################################################
function usage() {
    local exit_code="${1:-0}"
    local msg="${2:-}"

    [[ -n "${msg}" ]] && printf '%s\n' "${msg}" >&2

    cat <<EOF
Usage: $(basename "$0") [OPTIONS]

Count TODO comments in a specified file.

Options:
  -s, --search TERM    Search term to count (default: TODO)
  -f, --file PATH      File to search in (required)
  -h, --help           Show this help and exit

Examples:
  $(basename "$0") --search TODO --file src/main.py
  $(basename "$0") -s FIXME -f src/utils.py
EOF

    exit "${exit_code}"
}


#######################################################################################################################################################################################
# Process Script's Command Line Argument(s)
#######################################################################################################################################################################################
while [[ "${1}" != "" ]]; do
    case ${1} in
        "${HELP_SHORT}" | "${HELP_LONG}")
            usage 0
        ;;
        "${SEARCH_SHORT}" | "${SEARCH_LONG}")
            shift
            PARAM="${1}"
            if [[ ${PARAM} != "" ]]; then
                SEARCH_TERM="${PARAM}"
            fi
        ;;
        "${FILE_SHORT}" | "${FILE_LONG}")
            shift
            PARAM="${1}"
            if [[ ( ${PARAM} != "" ) && ( -f ${PARAM} ) ]]; then
                SEARCH_FILE="${PARAM}"
            else
                usage 1 "Error: Received an invalid Search File: \"${PARAM}\"\n"
            fi
        ;;
        *)
            usage 1 "Error: Invalid command line params: \"${*}\"\n"
        ;;
    esac
    shift
done


#######################################################################################################################################################################################
# Search for instances of a specific search term in the specified source code file
#######################################################################################################################################################################################
# RAW_OUTPUT="$(grep "${SEARCH_TERM}" ${SEARCH_FILE})"
COUNT="$(grep -ic "${SEARCH_TERM}" "${SEARCH_FILE}")"


#######################################################################################################################################################################################
# Display Results
#######################################################################################################################################################################################
echo "${COUNT}"

exit 0
